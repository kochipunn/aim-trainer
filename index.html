<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Aim Trainer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #111;
  color: white;
  font-family: sans-serif;
  overflow: hidden;
  user-select: none;
}

button, input {
  padding: 10px;
  font-size: 16px;
  margin-top: 5px;
}

#home, #result {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 15px;
  text-align: center;
}

#ui {
  position: fixed;
  top: 10px;
  left: 10px;
  display: none;
  gap: 15px;
  font-size: 18px;
}

.dot {
  position: absolute;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: cyan;
  box-shadow: 0 0 20px cyan;
  cursor: crosshair;
}

.sound-on { animation: shake .3s; }
.sound-off { animation: pop .2s; }

@keyframes shake {
  0% { transform: rotate(0); }
  25% { transform: rotate(5deg); }
  50% { transform: rotate(-5deg); }
  75% { transform: rotate(5deg); }
  100% { transform: rotate(0); }
}

@keyframes pop {
  from { transform: scale(0.7); }
  to { transform: scale(1); }
}
</style>
</head>

<body>

<!-- ãƒ›ãƒ¼ãƒ  -->
<div id="home">
  <h1>Aim Trainer</h1>
  <input id="nameInput" placeholder="åå‰ã‚’å…¥åŠ›">
  <button id="soundBtn" onclick="toggleSound()">ðŸ”Š SOUND ON</button>
  <button onclick="startGame(event)">START</button>
  <div id="ranking"></div>
</div>

<!-- ã‚²ãƒ¼ãƒ UI -->
<div id="ui">
  <div id="score">Score: 0</div>
  <div id="timer">30</div>
</div>

<!-- çµæžœ -->
<div id="result">
  <h2>RESULT</h2>
  <p id="resultText"></p>
  <button onclick="location.reload()">HOME</button>
</div>

<!-- éŸ³ -->
<audio id="hit" src="hit.mp3"></audio>
<audio id="miss" src="miss.mp3"></audio>

<script>
/* ===== å¤‰æ•° ===== */
let playerName = localStorage.getItem("playerName") || "";
let soundOn = localStorage.getItem("sound") !== "off";
let score = 0;
let time = 30;
let dot = null;
let playing = false;

const hitSE = document.getElementById("hit");
const missSE = document.getElementById("miss");
const soundBtn = document.getElementById("soundBtn");
const nameInput = document.getElementById("nameInput");

nameInput.value = playerName;
updateSoundBtn();
updateHome();

/* ===== éŸ³å†ç”Ÿï¼ˆå®Œå…¨åˆ¶å¾¡ï¼‰ ===== */
function playSE(audio) {
  if (!soundOn) return;
  audio.currentTime = 0;
  audio.play();
}

/* ===== ã‚µã‚¦ãƒ³ãƒ‰åˆ‡æ›¿ ===== */
function updateSoundBtn() {
  soundBtn.textContent = soundOn ? "ðŸ”Š SOUND ON" : "ðŸ”‡ SOUND OFF";
}

function toggleSound() {
  soundOn = !soundOn;
  localStorage.setItem("sound", soundOn ? "on" : "off");
  soundBtn.className = soundOn ? "sound-on" : "sound-off";
  updateSoundBtn();
}

/* ===== ã‚²ãƒ¼ãƒ é–‹å§‹ ===== */
function startGame(e) {
  e.stopPropagation();

  const name = nameInput.value.trim();
  if (!name) {
    alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
    return;
  }

  playerName = name;
  localStorage.setItem("playerName", playerName);

  document.getElementById("home").style.display = "none";
  document.getElementById("ui").style.display = "flex";

  score = 0;
  time = 30;
  playing = true;

  document.getElementById("score").textContent = "Score: 0";
  document.getElementById("timer").textContent = "30";

  spawnDot();
  startTimer();
}

/* ===== ãƒ‰ãƒƒãƒˆç”Ÿæˆ ===== */
function spawnDot() {
  if (!playing) return;
  if (dot) dot.remove();

  dot = document.createElement("div");
  dot.className = "dot";

  dot.style.left = Math.random() * (innerWidth - 40) + "px";
  dot.style.top = Math.random() * (innerHeight - 40) + "px";

  dot.onclick = (e) => {
    e.stopPropagation();
    score++;
    playSE(hitSE);
    document.getElementById("score").textContent = "Score: " + score;
    spawnDot();
  };

  document.body.appendChild(dot);
}

/* ===== MISSï¼ˆå®Œå…¨ä¿®æ­£ç‰ˆï¼‰ ===== */
document.body.onclick = (e) => {
  if (!playing) return;
  if (e.target !== dot) {
    playSE(missSE);
  }
};

/* ===== ã‚¿ã‚¤ãƒžãƒ¼ ===== */
function startTimer() {
  const t = setInterval(() => {
    time--;
    document.getElementById("timer").textContent = time;
    if (time <= 0) {
      clearInterval(t);
      endGame();
    }
  }, 1000);
}

/* ===== çµ‚äº† ===== */
function endGame() {
  playing = false;
  if (dot) dot.remove();

  updateRanking();
  document.getElementById("resultText").textContent =
    `${playerName} ã®ã‚¹ã‚³ã‚¢ï¼š${score}`;
  document.getElementById("result").style.display = "flex";
}

/* ===== ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ ===== */
function updateRanking() {
  const key = "ranking";
  let rankings = JSON.parse(localStorage.getItem(key)) || [];
  rankings.push({ name: playerName, score });
  rankings.sort((a, b) => b.score - a.score);
  rankings = rankings.slice(0, 10);
  localStorage.setItem(key, JSON.stringify(rankings));
  displayRanking(rankings);
}

function displayRanking(rankings) {
  const r = document.getElementById("ranking");
  r.innerHTML =
    "<b>RANKING</b><br>" +
    rankings.map((e, i) => `${i + 1}. ${e.name}: ${e.score}`).join("<br>");
}

function updateHome() {
  const rankings = JSON.parse(localStorage.getItem("ranking")) || [];
  displayRanking(rankings);
}
</script>

</body>
</html>
