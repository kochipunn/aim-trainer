<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Aim Trainer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #111;
  color: white;
  font-family: sans-serif;
  overflow: hidden;
  user-select: none;
}

button, input {
  padding: 10px 16px;
  font-size: 16px;
}

#home, #result, #pause {
  position: fixed;
  inset: 0;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 15px;
  background: #111;
}

#home { display: flex; z-index: 10; }
#result { z-index: 20; }
#pause { z-index: 30; background: rgba(0,0,0,.85); }

#ui {
  position: fixed;
  top: 10px;
  left: 10px;
  display: none;
  gap: 15px;
  font-size: 18px;
  z-index: 5;
}

.dot {
  position: absolute;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: cyan;
  box-shadow: 0 0 20px cyan;
}
</style>
</head>

<body>

<div id="home">
  <h1>Aim Trainer</h1>
  <input id="nameInput" placeholder="åå‰ã‚’å…¥åŠ›">
  <button id="soundBtn">ðŸ”Š SOUND ON</button>
  <button id="startBtn">START</button>
  <div id="ranking"></div>
</div>

<div id="ui">
  <div id="score">Score: 0</div>
  <div id="timer">30</div>
</div>

<div id="pause">PAUSED</div>

<div id="result">
  <h2>RESULT</h2>
  <p id="resultText"></p>
  <button onclick="location.reload()">HOME</button>
</div>

<audio id="hit" src="hit.mp3"></audio>
<audio id="miss" src="miss.mp3"></audio>

<script>
let score = 0;
let time = 30;
let dot = null;
let playing = false;
let timerId = null;

const hitSE = document.getElementById("hit");
const missSE = document.getElementById("miss");

let soundOn = localStorage.getItem("sound") !== "off";

const home = document.getElementById("home");
const ui = document.getElementById("ui");
const result = document.getElementById("result");
const pause = document.getElementById("pause");
const soundBtn = document.getElementById("soundBtn");
const nameInput = document.getElementById("nameInput");

nameInput.value = localStorage.getItem("playerName") || "";

function updateSoundBtn() {
  soundBtn.textContent = soundOn ? "ðŸ”Š SOUND ON" : "ðŸ”‡ SOUND OFF";
}
updateSoundBtn();

soundBtn.onclick = () => {
  soundOn = !soundOn;
  localStorage.setItem("sound", soundOn ? "on" : "off");
  updateSoundBtn();
};

document.getElementById("startBtn").onclick = () => {
  const name = nameInput.value.trim();
  if (!name) return alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

  localStorage.setItem("playerName", name);

  home.style.display = "none";
  result.style.display = "none";
  ui.style.display = "flex";

  score = 0;
  time = 30;
  playing = true;

  document.getElementById("score").textContent = "Score: 0";
  document.getElementById("timer").textContent = "30";

  spawnDot();
  startTimer();
};

function spawnDot() {
  if (!playing) return;
  if (dot) dot.remove();

  dot = document.createElement("div");
  dot.className = "dot";

  dot.style.left = Math.random() * (innerWidth - 40) + "px";
  dot.style.top = Math.random() * (innerHeight - 40) + "px";

  dot.onclick = (e) => {
    e.stopPropagation();
    score++;
    if (soundOn) {
      hitSE.currentTime = 0;
      hitSE.play();
    }
    document.getElementById("score").textContent = "Score: " + score;
    spawnDot();
  };

  document.body.appendChild(dot);
}

document.body.onclick = (e) => {
  if (playing && !e.target.classList.contains("dot") && soundOn) {
    missSE.currentTime = 0;
    missSE.play();
  }
};

function startTimer() {
  timerId = setInterval(() => {
    time--;
    document.getElementById("timer").textContent = time;
    if (time <= 0) endGame();
  }, 1000);
}

function endGame() {
  playing = false;
  clearInterval(timerId);
  if (dot) dot.remove();

  ui.style.display = "none";
  result.style.display = "flex";

  const name = localStorage.getItem("playerName");
  document.getElementById("resultText").textContent =
    `${name} ã®ã‚¹ã‚³ã‚¢ï¼š${score}`;

  saveRanking(name, score);
}

function saveRanking(name, score) {
  let r = JSON.parse(localStorage.getItem("ranking")) || [];
  r.push({ name, score });
  r.sort((a,b)=>b.score-a.score);
  r = r.slice(0,10);
  localStorage.setItem("ranking", JSON.stringify(r));
  showRanking(r);
}

function showRanking(r) {
  document.getElementById("ranking").innerHTML =
    "<b>RANKING</b><br>" +
    r.map((e,i)=>`${i+1}. ${e.name}: ${e.score}`).join("<br>");
}

showRanking(JSON.parse(localStorage.getItem("ranking")) || []);
</script>

</body>
</html>
